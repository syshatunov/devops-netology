# Домашнее задание 05-virt-01-basics

<br>

## Задание 1
Опишите кратко, в чём основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.<br>

### Ответ
**Полная виртуализация** – гипервизор запускается непосредственно на аппаратной платформе. Гепервизор получает полный доступ к железу, что является с одной стороны преимуществом, однако требует драйверов и поддержки оборудования со стороны разработчиков гипервозора. (**Пример**: VMWare ESXi)<br><br>

**Паравертуализация** – гипервизор запускается на базе какой-либо операционной системы. Ресурсы делятся между ОС и гипервизором. Поддержка оборудования более простая. В ряде случаев гипервозор можем получать прямой доступ к оборудованию, забирая его у ОС. (**Пример**: проброс USB устройств в VMware Workstation или Virtual Box, перехват сетевых карт в Hyper-V)<br><br>
**Виртуализация на уровне ОС** – гипервизор требует ОС для запуска и гипервизор может запускать только виртуальные машина с тем же ядром, что и ОС на хосте. (**Примеры**: LXC, OpenVZ)<br><br>

***В отличии от полной виртуализации, при паравиртуализации в ядро системы вносятся определённые модификации (для разделения доступа к аппаратному обеспечению). В случае полной виртуализации, устройства виртуальной машины эмулируются полностью, вплоть до регистров, памяти и .т.д. Паравиртуализация позволяет осуществлять прямой доступ к некоторым типам оборудования, например паравиртуализацию используют PCI устройства.***


## Задание 2
Выберите один из вариантов использования организации физических серверов в зависимости от условий использования.

### Ответ

#### 1. Высоконагруженная база данных, чувствительная к отказу
- ***Физические серверы***. Такое решение позволит СУБД получить максимальную производительность от аппаратного обеспечения.<br>
Жизнеспособность такого подхода доказала Oracle с программно-аппаратными решениями для своей СУБД. Обязательна настройка кластера СУБД.<br>
- ***Паравиртуализация***. Также может быть подходящим решением, т. к. отказоустойчивость будет выше (за счёт резервирования на уровне гипервизора, например Hyper-V Replica), но немного пострадает производительность, т. к. операционная система заберёт часть ресурсов сервера на себя.

#### 2. Различные веб приложения
- ***Паравиртуализация***. Такое решение проще чем виртуализация уровня ОС (изоляция ресурсов для гостевых операционных систем, возможность использовать разные гостевые ОС). Остальные решения не подойдут в общем случае (ASP.NET Core web приложения на .NET framework 4 нельзя запустить на Linux). Физические серверы наименее гибкие для этой задачи.

#### 3. Windows системы для использования бухгалтерским отделом
- ***Паравиртуализация***. Такое решение позволит отказаться от ограничений физических серверов (можно делать снепшоты и организовать отказоустойчивость на уровне гипервизора). Виртуализация уровня ОС не подойдёт, т. к. есть сложности с официальной поддержкой от разработчиков бух. программ (1С, программы с GUI, сложности с организацией терминального доступа).

#### 4. Системы, выполняющие высокопроизводительные расчеты на GPU
- ***Физические серверы***. В таком решении мы получим прямой доступ к GPU без посредников. На многопроцессорных системных с несколькими GPU разница с паравиртуализацией будет сильно заметна (Поддержка технологии NUMA или проброс нескольких GPU в одну VM в некоторых гипервизорах просто не реализован).


## Задание 3
Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.<br><br>
**Сценарии**:<br>
1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based-инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
2. Требуется наиболее производительное бесплатное open source-решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows-инфраструктуры.
4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

### Ответ
1. **Hyper-V на Windows Server**: все вышеперечисленные задачи можно решить или непосредственно в Windows Server или при помощи SCCM (для управления виртуальными машинами нужен компонент System Center Virtual Machine Manager). Для репликации данных можем использовать Hyper-V replica, DFS, storage replica. Программные балансировщики смогут работать в виртуальных машинах Hyper-V. Однако стоит заранее подсчитать стоимость лицензий и сравнить их с решениями от VMware. Т. к. Windows Server сейчас лицензируется по ядрам процессоров.
2. **ProxMox**: бесплатное решение, есть возможность настроить кластер, поддерживаются как Windows, так и Linux гостевые ОС. Также можно использовать Hyper-V Server (бесплатен). В каждом из вариантов лицензии на Windows оплачиваются отдельно.
3. **Hyper-V на Windows Server**: гипервизор входит в состав ОС, отдельную лицензию оплачивать не нужно.
4. **Virtual Box** или **ProxMox**: т. к. можно запускать виртуальные машина на разных ядрах. Также можно запускать разные VM изолированно друг от друга. Обе системы показали свою жизнеспособность в реальных проектах для аналогичных задач.

## Задание 4
Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

### Ответ
- **Дороговизна**, т. к. необходимость оплачивать несколько лицензий на разные гипервизоры.
- **Квалифицированный персонал**, необходимо иметь в штате обученных сотрудников, поддерживающих разные гипервизоры.
- **Нет интеграции между гипервизорами разных производителей**. Т.е. нельзя на лету мигрировать виртуальную машину например VMware на Hyper-V хост из-за разной организации виртуальных машин у разработчиков гипервизоров.
- **Проблемы совместимости оборудования**. Например, у одного разработчика гипервизора может не оказаться драйверов для поддержки того или иного оборудования, но несмотря на все недостатки я выберу использование гетерогенных сред.
- **Гетерогенные среды позволяют получить преимущества как платных, так и бесплатных гипервизоров**. Windows системы и приложения целесообразно разворачивать на Hyper-V (лучше поддержка). Остальные приложения можно запускать на других типах гипервизоров исходя из экономической обоснованности такого решения.
- **Поддержка разных типов гипервизоров можем быть сложной**, однако позволяет администраторам получить альтернативу, при проблемах, которые нельзя решить на каком-либо гипервизоре.
- **Отсутствие интеграции можно нивелировать разворачивая кластеры разных гипервизоров** так, чтобы мигрировать виртуальные машины и приложения между гипервизорами одного типа.
- **По оборудованию – использовать максимально совместимое оборудование**. Использование контейнеров зачастую позволяет абстрагироваться от гипервизоров (современное оборудование гарантирует высокий уровень совместимости). Однако не все приложения можно запускать в контейнерах.
<br>

В повседневной работе использую в основном гипервизоры полной виртуализации для получения преимущества эффективного использования ресурсов физических серверов.
<br><br>